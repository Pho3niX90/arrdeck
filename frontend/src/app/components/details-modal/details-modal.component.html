@if (isOpen) {
<div class="fixed inset-0 z-40 flex items-center justify-center p-4">
    <!-- Backdrop Blur -->
    <div class="absolute inset-0 bg-black/80 backdrop-blur-xl transition-all duration-300" (click)="onClose()"></div>

    <!-- Modal Content -->
    <div
        class="relative bg-slate-900 border border-slate-700 w-full max-w-5xl h-[85vh] rounded-3xl shadow-2xl overflow-hidden flex flex-col animate-enter">

        <!-- Close Button -->
        <button (click)="onClose()"
            class="absolute top-4 right-4 z-50 p-2 bg-black/50 hover:bg-black/70 rounded-full text-white backdrop-blur-md transition">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                stroke="currentColor" class="w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
            </svg>
        </button>

        @if (loading()) {
        <div class="absolute inset-0 flex items-center justify-center text-white">
            <svg class="animate-spin h-8 w-8 text-blue-500" xmlns="http://www.w3.org/2000/svg" fill="none"
                viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor"
                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                </path>
            </svg>
        </div>
        } @else {

        <!-- Main Content Area (Scrollable Info + Poster) -->
        <div class="flex-1 flex flex-col md:flex-row min-h-0 overflow-hidden relative">

            <!-- Left: Poster -->
            <div class="w-full md:w-1/3 lg:w-1/4 h-64 md:h-full relative shrink-0">
                <img [src]="details()?.poster_path | tmdbImage:'w500':'poster'"
                    class="w-full h-full object-cover opacity-80" alt="poster" />
                <div
                    class="absolute inset-0 bg-linear-to-t from-slate-900 via-transparent to-transparent md:bg-linear-to-r md:from-transparent md:to-slate-900/80">
                </div>
            </div>

            <!-- Right: Info -->
            <div class="flex-1 flex flex-col p-8 md:pl-8 relative overflow-y-auto custom-scrollbar min-w-0">

                <!-- Background Fade -->
                <div class="absolute top-0 right-0 w-full h-96 -z-10 opacity-20 pointer-events-none">
                    <img [src]="details()?.backdrop_path | tmdbImage:'w1280':'backdrop'"
                        class="w-full h-full object-cover mask-image-b" />
                </div>

                <!-- Header -->
                <div class="mb-6">
                    <h1 class="text-4xl font-bold text-white mb-2 leading-tight">{{ details()?.title }}</h1>
                    <div class="flex flex-wrap items-center gap-4 text-sm text-slate-400 font-medium">
                        <span class="bg-slate-800 text-white px-2 py-1 rounded border border-slate-700">{{
                            details()?.year
                            }}</span>
                        @if (details()?.runtime) {
                        <span>{{ details()?.runtime }} min</span>
                        }
                        @if (details()?.certification) {
                        <span class="border border-slate-600 px-1 rounded">{{ details()?.certification }}</span>
                        }
                        @if (details()?.original_language) {
                        <span class="uppercase text-slate-500">{{ details()?.original_language }}</span>
                        }
                        <div class="flex items-center gap-1 text-yellow-500">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                                class="w-4 h-4">
                                <path fill-rule="evenodd"
                                    d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.005Z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span>{{ details()?.rating | number:'1.1-1' }}</span>
                        </div>

                        @if (details()?.genres?.length) {
                        <div class="w-px h-4 bg-slate-700 mx-1"></div>
                        <div class="flex items-center gap-1.5 flex-wrap">
                            @for (genre of details()?.genres | slice:0:3; track genre) {
                            <span
                                class="px-2.5 py-0.5 rounded-full bg-slate-800/80 border border-slate-700/50 text-xs font-medium text-slate-300 shadow-sm backdrop-blur-sm">
                                {{ $any(genre) | titlecase }}
                            </span>
                            }
                        </div>
                        }

                        @if (details()?.keywords?.length) {
                        <div class="w-px h-4 bg-slate-700 mx-1"></div>
                        <div class="flex items-center gap-1.5 flex-wrap">
                            @for (keyword of details()?.keywords | slice:0:4; track keyword) {
                            <span
                                class="px-2 py-0.5 rounded text-[10px] font-medium text-indigo-300 bg-indigo-500/10 border border-indigo-500/20">
                                {{ $any(keyword) | titlecase }}
                            </span>
                            }
                        </div>
                        }
                    </div>
                </div>

                <!-- Actions -->
                <div class="flex items-center gap-4 mb-8">
                    @if (jellyfinItemId()) {
                    <button (click)="openInJellyfin()"
                        class="flex items-center gap-2 px-4 py-3 bg-purple-600/20 hover:bg-purple-600/30 text-purple-300 hover:text-purple-200 border border-purple-500/30 rounded-full font-bold transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z" />
                        </svg>
                        Open in Jellyfin
                    </button>
                    }

                    @if (inLibrary()) {
                    <div
                        class="flex items-center gap-2 px-4 py-2 bg-green-500/10 text-green-400 rounded-full border border-green-500/20">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                            <path fill-rule="evenodd"
                                d="M16.704 4.153a.75.75 0 0 1 .143 1.052l-8 10.5a.75.75 0 0 1-1.127.075l-4.5-4.5a.75.75 0 0 1 1.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 0 1 1.05-.143Z"
                                clip-rule="evenodd" />
                        </svg>
                        <span class="font-bold">In Library</span>
                    </div>
                    } @else {
                    <button (click)="showAddModal = true"
                        class="flex items-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-500 text-white rounded-full font-bold shadow-lg shadow-blue-900/20 transition hover:scale-105 active:scale-95">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                            <path
                                d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z" />
                        </svg>
                        Add to {{ type === 'movie' ? 'Radarr' : 'Sonarr' }}
                    </button>
                    }
                </div>

                <!-- Plot -->
                <div class="mb-8">
                    <h3 class="text-lg font-bold text-white mb-2">Overview</h3>
                    <p class="text-slate-300 leading-relaxed">{{ details()?.overview }}</p>
                </div>


                <!-- Collection Info -->
                @if (collectionInfo(); as col) {
                <div class="mb-6">
                    <div class="bg-indigo-500/10 border border-indigo-500/20 rounded-lg overflow-hidden">
                        <div class="p-4 flex gap-4 cursor-pointer hover:bg-white/5 transition relative"
                            (click)="expandedCollection.set(!expandedCollection())">

                            @if (col.poster_path) {
                            <img [src]="col.poster_path | tmdbImage:'w92':'poster'"
                                class="w-10 h-15 object-cover rounded shadow-sm opacity-90" loading="lazy"
                                alt="poster" />
                            }

                            <div class="min-w-0 flex-1 flex flex-col justify-center">
                                <p class="text-[10px] text-indigo-300 font-bold uppercase tracking-wider mb-0.5">Part of
                                    the
                                </p>
                                <h4 class="text-indigo-100 font-bold text-sm truncate">{{ col.name }}</h4>
                                @if (col.parts) {
                                <p class="text-[10px] text-indigo-300/70 mt-0.5">{{ col.parts.length }} Movies</p>
                                }
                            </div>

                            <div class="flex items-center gap-4">
                                <div (click)="$event.stopPropagation()">
                                    @if (col.monitored) {
                                    <div
                                        class="shrink-0 px-3 py-1.5 bg-green-500/10 text-green-400 text-xs font-bold rounded-md border border-green-500/20 flex items-center gap-2 cursor-default">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                            class="w-3 h-3">
                                            <path fill-rule="evenodd"
                                                d="M16.704 4.153a.75.75 0 0 1 .143 1.052l-8 10.5a.75.75 0 0 1-1.127.075l-4.5-4.5a.75.75 0 0 1 1.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 0 1 1.05-.143Z"
                                                clip-rule="evenodd" />
                                        </svg>
                                        {{
                                        col.libraryCount ? col.libraryCount + ' / ' + (col.parts.length ||
                                        col.libraryCount) : ''
                                        }} In Library
                                    </div>
                                    } @else {
                                    <button (click)="openCollectionAddModal()"
                                        class="shrink-0 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-500 text-white text-xs font-bold rounded-md shadow-sm transition flex items-center gap-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                            class="w-3 h-3">
                                            <path
                                                d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z" />
                                        </svg>
                                        Add Collection
                                    </button>
                                    }
                                </div>

                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                    class="w-5 h-5 text-indigo-400 transition-transform duration-200"
                                    [class.rotate-180]="expandedCollection()">
                                    <path fill-rule="evenodd"
                                        d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
                                        clip-rule="evenodd" />
                                </svg>
                            </div>
                        </div>

                        @if (expandedCollection() && col.parts.length) {
                        <div class="px-4 pb-4">
                            <div class="w-full h-px bg-indigo-500/20 mb-3"></div>
                            <h5 class="text-[10px] text-indigo-300 font-bold uppercase tracking-wider mb-2">Movies in
                                Collection</h5>
                            <div
                                class="flex gap-3 overflow-x-auto pb-2 scrollbar-thin scrollbar-thumb-indigo-500/20 hover:scrollbar-thumb-indigo-500/40 scrollbar-track-transparent">
                                @for (part of col.parts; track part.id) {
                                <div class="w-20 shrink-0 flex flex-col gap-1 group cursor-pointer hover:opacity-80 transition"
                                    (click)="switchToItem(part.id, 'movie')">
                                    <div
                                        class="aspect-2/3 bg-slate-800 rounded overflow-hidden relative border border-white/5">
                                        @if (part.poster_path) {
                                        <img [src]="part.poster_path | tmdbImage:'w154':'poster'"
                                            class="w-full h-full object-cover" alt="poster">
                                        } @else {
                                        <div
                                            class="w-full h-full flex items-center justify-center text-[10px] text-slate-500 p-1 text-center font-bold">
                                            {{ part.title }}
                                        </div>
                                        }

                                        @if (part.inLibrary) {
                                        <div
                                            class="absolute top-1 right-1 w-2 h-2 rounded-full bg-green-500 shadow-sm border border-black/20">
                                        </div>
                                        }
                                    </div>
                                    <p class="text-[10px] text-indigo-100 truncate font-medium leading-tight group-hover:text-white transition"
                                        [title]="part.title">{{ part.title }}</p>
                                    @if (part.release_date) {
                                    <p class="text-[9px] text-indigo-300/50">{{ part.release_date | date:'yyyy' }}</p>
                                    }
                                </div>
                                }
                            </div>
                        </div>
                        }
                    </div>
                </div>
                }

                <!-- Seasons (For TV Shows) -->
                @if (type === 'show' && details()?.seasons?.length) {
                <div class="mb-8">
                    <h3 class="text-lg font-bold text-white mb-3">Seasons</h3>
                    <div class="space-y-2">
                        @for (season of details()?.seasons; track season.id) {
                        <div class="bg-slate-800/50 rounded-lg overflow-hidden border border-slate-700/50">
                            <button (click)="toggleSeason(season.season_number)"
                                class="w-full flex items-center justify-between p-4 hover:bg-slate-800 transition text-left">
                                <div class="flex items-center gap-4">
                                    <div class="w-10 h-14 bg-slate-900 rounded overflow-hidden shrink-0 relative">
                                        @if (season.poster_path) {
                                        <img [src]="season.poster_path | tmdbImage:'w500':'poster'"
                                            class="w-full h-full object-cover">
                                        } @else {
                                        <div
                                            class="w-full h-full flex items-center justify-center text-xs text-slate-600 font-bold">
                                            {{ season.season_number }}
                                        </div>
                                        }
                                        @if (inLibrary()) {
                                        @switch (getSeasonStatus(season.season_number, season.episode_count)) {
                                        @case ('full') {
                                        <div
                                            class="absolute -bottom-1 -right-1 bg-green-500 text-white rounded-full p-0.5 shadow-sm border border-slate-900">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                                fill="currentColor" class="w-2.5 h-2.5">
                                                <path fill-rule="evenodd"
                                                    d="M16.704 4.153a.75.75 0 0 1 .143 1.052l-8 10.5a.75.75 0 0 1-1.127.075l-4.5-4.5a.75.75 0 0 1 1.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 0 1 1.05-.143Z"
                                                    clip-rule="evenodd" />
                                            </svg>
                                        </div>
                                        }
                                        @case ('partial') {
                                        <div
                                            class="absolute -bottom-1 -right-1 bg-orange-500 text-white rounded-full p-0.5 shadow-sm border border-slate-900">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                                fill="currentColor" class="w-2.5 h-2.5">
                                                <path
                                                    d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z" />
                                            </svg>
                                        </div>
                                        }
                                        @case ('none') {
                                        <div
                                            class="absolute -bottom-1 -right-1 bg-red-500 text-white rounded-full p-0.5 shadow-sm border border-slate-900">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                                fill="currentColor" class="w-2.5 h-2.5">
                                                <path
                                                    d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
                                            </svg>
                                        </div>
                                        }
                                        }
                                        }
                                    </div>
                                    <div>
                                        <h4 class="text-white font-bold text-sm">{{ season.name }}</h4>
                                        <div class="flex items-center gap-2 text-xs text-slate-400">
                                            <span>{{ season.episode_count }} Episodes</span>
                                            @if (season.air_date) {
                                            <span>• {{ season.air_date | date:'yyyy' }}</span>
                                            }
                                        </div>
                                    </div>
                                </div>
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                    class="w-5 h-5 text-slate-400 transition-transform duration-200"
                                    [class.rotate-180]="expandedSeason() === season.season_number">
                                    <path fill-rule="evenodd"
                                        d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
                                        clip-rule="evenodd" />
                                </svg>
                            </button>

                            @if (expandedSeason() === season.season_number) {
                            <div class="border-t border-slate-700/50 bg-slate-900/30">
                                @if (loadingSeason() === season.season_number) {
                                <div class="p-8 flex justify-center">
                                    <svg class="animate-spin h-6 w-6 text-blue-500" xmlns="http://www.w3.org/2000/svg"
                                        fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                            stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor"
                                            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                        </path>
                                    </svg>
                                </div>
                                } @else {
                                <div class="divide-y divide-slate-800">
                                    @for (ep of seasonEpisodes()[season.season_number]; track ep.id) {
                                    <div class="p-3 flex gap-4 hover:bg-slate-800/30 transition">
                                        <div
                                            class="w-24 shrink-0 rounded overflow-hidden aspect-video bg-slate-900 relative">
                                            @if (ep.still_path) {
                                            <img [src]="ep.still_path | tmdbImage:'w154':'still'"
                                                class="w-full h-full object-cover">
                                            } @else {
                                            <div class="w-full h-full flex items-center justify-center text-slate-700">
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                                                    fill="currentColor" class="w-6 h-6">
                                                    <path fill-rule="evenodd"
                                                        d="M1.5 6a2.25 2.25 0 012.25-2.25h16.5A2.25 2.25 0 0122.5 6v12a2.25 2.25 0 01-2.25 2.25H3.75A2.25 2.25 0 011.5 18V6zM3 16.06V18c0 .414.336.75.75.75h16.5A.75.75 0 0021 18v-1.94l-2.69-2.689a1.5 1.5 0 00-2.12 0l-.88.879.97.97a.75.75 0 11-1.06 1.06l-5.16-5.159a1.5 1.5 0 00-2.12 0L3 16.061zm10.125-7.81a1.125 1.125 0 112.25 0 1.125 1.125 0 01-2.25 0z"
                                                        clip-rule="evenodd" />
                                                </svg>
                                            </div>
                                            }
                                            @if (isDownloaded(season.season_number, ep.episode_number)) {
                                            <div
                                                class="absolute bottom-1 right-1 bg-green-500 text-white rounded-full p-0.5 shadow-sm">
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                                    fill="currentColor" class="w-3 h-3">
                                                    <path fill-rule="evenodd"
                                                        d="M16.704 4.153a.75.75 0 0 1 .143 1.052l-8 10.5a.75.75 0 0 1-1.127.075l-4.5-4.5a.75.75 0 0 1 1.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 0 1 1.05-.143Z"
                                                        clip-rule="evenodd" />
                                                </svg>
                                            </div>
                                            }
                                        </div>
                                        <div class="min-w-0 flex-1 flex flex-col justify-center">
                                            <div class="flex items-start justify-between gap-2 mb-1">
                                                <h5 class="text-white font-medium text-sm truncate">
                                                    <span class="text-slate-500 mr-2">{{ ep.episode_number }}.</span>
                                                    {{ ep.name }}
                                                </h5>
                                                @if (ep.vote_average > 0) {
                                                <div
                                                    class="flex items-center gap-1 text-[10px] text-yellow-500 shrink-0 bg-yellow-500/10 px-1.5 py-0.5 rounded">
                                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                                        fill="currentColor" class="w-3 h-3">
                                                        <path fill-rule="evenodd"
                                                            d="M10.868 2.884c-.321-.772-1.415-.772-1.736 0l-1.83 4.401-4.753.381c-.833.067-1.171 1.107-.536 1.651l3.62 3.102-1.106 4.637c-.194.813.691 1.456 1.405 1.02L10 15.591l4.069 2.485c.713.436 1.598-.207 1.404-1.02l-1.106-4.637 3.62-3.102c.635-.544.297-1.584-.536-1.65l-4.752-.382-1.831-4.401z"
                                                            clip-rule="evenodd" />
                                                    </svg>
                                                    {{ ep.vote_average | number:'1.1-1' }}
                                                </div>
                                                }
                                            </div>

                                            <p class="text-xs text-slate-400 mb-1 line-clamp-2">{{ ep.overview }}</p>

                                            <div class="text-[10px] text-slate-500 font-mono">
                                                {{ ep.air_date | date:'mediumDate' }} • {{ ep.runtime }}m
                                            </div>
                                        </div>
                                    </div>
                                    }
                                </div>
                                }
                            </div>
                            }
                        </div>
                        }
                    </div>
                </div>
                }

                <!-- Recommendations -->
                @if (recommendations().length) {
                <div class="mb-8">
                    <h3 class="text-lg font-bold text-white mb-3">Recommendations</h3>
                    <div
                        class="flex gap-3 overflow-x-auto pb-2 scrollbar-thin scrollbar-thumb-indigo-500/20 hover:scrollbar-thumb-indigo-500/40 scrollbar-track-transparent">
                        @for (item of recommendations(); track item.id) {
                        <div class="w-24 shrink-0 flex flex-col gap-1 group cursor-pointer hover:opacity-80 transition"
                            (click)="switchToItem(item.id)">
                            <div class="aspect-2/3 bg-slate-800 rounded overflow-hidden relative border border-white/5">
                                @if (item.poster_path) {
                                <img [src]="item.poster_path | tmdbImage:'w154':'poster'"
                                    class="w-full h-full object-cover">
                                } @else {
                                <div
                                    class="w-full h-full flex items-center justify-center text-[10px] text-slate-500 p-1 text-center font-bold">
                                    {{ item.title || item.name }}
                                </div>
                                }
                                <div
                                    class="absolute top-1 right-1 bg-black/60 rounded text-[9px] text-white px-1 font-bold">
                                    {{ item.vote_average | number:'1.1-1' }}
                                </div>
                            </div>
                            <p class="text-[10px] text-slate-300 truncate font-medium leading-tight group-hover:text-white transition"
                                [title]="item.title || item.name">{{ item.title || item.name }}</p>
                        </div>
                        }
                    </div>
                </div>
                }

                <!-- Similar -->
                @if (similar().length) {
                <div class="mb-8">
                    <h3 class="text-lg font-bold text-white mb-3">Similar</h3>
                    <div
                        class="flex gap-3 overflow-x-auto pb-2 scrollbar-thin scrollbar-thumb-indigo-500/20 hover:scrollbar-thumb-indigo-500/40 scrollbar-track-transparent">
                        @for (item of similar(); track item.id) {
                        <div class="w-24 shrink-0 flex flex-col gap-1 group cursor-pointer hover:opacity-80 transition"
                            (click)="switchToItem(item.id)">
                            <div class="aspect-2/3 bg-slate-800 rounded overflow-hidden relative border border-white/5">
                                @if (item.poster_path) {
                                <img [src]="item.poster_path | tmdbImage:'w154':'poster'"
                                    class="w-full h-full object-cover">
                                } @else {
                                <div
                                    class="w-full h-full flex items-center justify-center text-[10px] text-slate-500 p-1 text-center font-bold">
                                    {{ item.title || item.name }}
                                </div>
                                }
                                <div
                                    class="absolute top-1 right-1 bg-black/60 rounded text-[9px] text-white px-1 font-bold">
                                    {{ item.vote_average | number:'1.1-1' }}
                                </div>
                            </div>
                            <p class="text-[10px] text-slate-300 truncate font-medium leading-tight group-hover:text-white transition"
                                [title]="item.title || item.name">{{ item.title || item.name }}</p>
                        </div>
                        }
                    </div>
                </div>
                }

            </div>
        </div>

        <!-- Footer: Cast (Fixed Bottom) -->
        <div class="shrink-0 bg-slate-950/50 backdrop-blur-md border-t border-white/5 p-4 z-10 w-full">
            <h3 class="text-sm font-bold text-slate-400 mb-3 px-1 uppercase tracking-wider">Cast</h3>
            <div class="grid grid-rows-1 grid-flow-col auto-cols-max gap-4 overflow-x-auto scrollbar-hide w-full px-1">
                <div class="grid grid-rows-2 grid-flow-col auto-cols-max gap-x-4 gap-y-2">
                    @for (person of people()?.cast; track person.id) {
                    <div class="flex items-center gap-3 w-48 pr-4">
                        <div
                            class="w-10 h-10 shrink-0 rounded-full overflow-hidden bg-slate-800 border border-slate-700 relative">
                            @if (person.profile_path) {
                            <img [src]="person.profile_path | tmdbImage:'w185':'profile'"
                                class="w-full h-full object-cover" loading="lazy" />
                            } @else {
                            <div
                                class="w-full h-full flex items-center justify-center text-slate-500 text-[10px] font-bold">
                                {{ person.name.charAt(0) }}
                            </div>
                            }
                        </div>
                        <div class="min-w-0">
                            <p class="text-white text-xs font-bold truncate">{{ person.name }}</p>
                            <p class="text-slate-500 text-[10px] truncate">{{ person.character }}</p>
                        </div>
                    </div>
                    }
                </div>
            </div>
        </div>

        }
    </div>

    <!-- Add Modal -->
    @if (showAddModal) {
    @if (details(); as d) {
    @if (d.ids.tmdb) {
    <app-add-media-modal [type]="type" [tmdbId]="d.ids.tmdb" [title]="d.title" [year]="d.year"
        (cancelled)="showAddModal = false" (added)="showAddModal = false; inLibrary.set(true)"></app-add-media-modal>
    }
    }
    }


    <!-- Collection Add Modal -->
    @if (showCollectionAddModal) {
    <app-add-media-modal [type]="'movie'" [tmdbId]="0" [title]="collectionInfo()?.name || 'Collection'" [year]="0"
        [mode]="'configure'" (cancelled)="showCollectionAddModal = false"
        (configure)="performAddCollection($event)"></app-add-media-modal>
    }

</div>
}